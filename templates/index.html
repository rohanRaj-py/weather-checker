<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WeatherNow - Interactive Forecast</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <meta name="description" content="Get real-time weather updates with beautiful visualizations and interactive forecasts">
    <meta name="keywords" content="weather, forecast, interactive, real-time, weather app">
</head>
<body>
    <div class="container">
        <!-- Animated Background -->
        <div class="cloud cloud1"></div>
        <div class="cloud cloud2"></div>
        <div class="cloud cloud3"></div>

        <!-- Header -->
        <header class="header">
            <div class="logo">
                <span class="logo-icon">üå¶Ô∏è</span>
                WeatherNow
            </div>
            <nav class="nav" id="mainNav">
                <a href="#" class="nav-link active">HOME</a>
                <a href="#" class="nav-link">ABOUT</a>
                <a href="#" class="nav-link">CLIMATE</a>
                <a href="#" class="nav-link">FORECAST</a>
                <a href="#" class="nav-link">NEWS</a>
                <a href="#" class="nav-link">MAP</a>
                <a href="#" class="nav-link">CONTACT</a>
                <button class="signup-btn" onclick="handleSignUp()">SIGN UP</button>
            </nav>
            <button class="mobile-menu-btn" onclick="toggleMobileMenu()" aria-label="Toggle mobile menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <section class="hero-section">
                <h1 class="hero-title">Weather Forecast Made Interactive</h1>
                <p class="hero-description">
                    Get real-time weather updates with beautiful visualizations and personalized recommendations for your daily activities. Experience weather like never before.
                </p>

                <div class="search-container">
                    <input type="text"
                           class="search-input"
                           id="cityInput"
                           placeholder="Enter your city or location..."
                           autocomplete="off"
                           aria-label="Search for city weather">
                    <button class="search-btn" onclick="searchWeather()" aria-label="Search weather">
                        <span class="search-text">Search Now</span>
                        <span class="search-loading" style="display: none;">
                            <span class="loading-dots">Searching</span>
                        </span>
                    </button>
                </div>

                <div class="quick-cities">
                    <span>Quick search:</span>
                    <button class="quick-city" onclick="quickSearch('London')" aria-label="Search London weather">London</button>
                    <button class="quick-city" onclick="quickSearch('New York')" aria-label="Search New York weather">New York</button>
                    <button class="quick-city" onclick="quickSearch('Tokyo')" aria-label="Search Tokyo weather">Tokyo</button>
                    <button class="quick-city" onclick="quickSearch('Paris')" aria-label="Search Paris weather">Paris</button>
                    <button class="quick-city" onclick="quickSearch('Sydney')" aria-label="Search Sydney weather">Sydney</button>
                </div>

                <div class="weather-tips">
                    <p class="tip-text" id="weatherTip">üí° Tip: Try searching for your hometown to get personalized weather updates!</p>
                </div>
            </section>

            <aside class="weather-card" id="weatherCard" tabindex="0" role="region" aria-label="Current weather information">
                <div class="weather-header">
                    <div class="location" id="location">{{ weather.location }}</div>
                    <div class="weather-time" id="weatherTime">Updated just now</div>
                    <button class="refresh-btn" onclick="refreshWeather()" aria-label="Refresh weather data" title="Refresh weather">
                        üîÑ
                    </button>
                </div>

                <div class="current-weather">
                    <div class="temperature-section">
                        <div class="current-temp" id="currentTemp">
                            {{ weather.temperature }}¬∞<span class="temp-unit">C</span>
                        </div>
                        <div class="feels-like" id="feelsLike">Feels like {{ weather.feels_like }}¬∞C</div>
                        <div class="weather-desc" id="weatherDesc">{{ weather.description }}</div>
                    </div>
                    <div class="weather-icon-main" id="weatherIcon" role="img" aria-label="Weather condition icon">
                        üå§Ô∏è
                    </div>
                </div>

                <div class="weather-details" id="weatherDetails">
                    <div class="detail-item" tabindex="0">
                        <div class="detail-icon" role="img" aria-label="Sunrise">‚òÄÔ∏è</div>
                        <div class="detail-info">
                            <div class="detail-label">Sunrise</div>
                            <div class="detail-value" id="sunrise">{{ weather.sunrise }}</div>
                        </div>
                    </div>
                    <div class="detail-item" tabindex="0">
                        <div class="detail-icon" role="img" aria-label="Sunset">üåÖ</div>
                        <div class="detail-info">
                            <div class="detail-label">Sunset</div>
                            <div class="detail-value" id="sunset">{{ weather.sunset }}</div>
                        </div>
                    </div>
                    <div class="detail-item" tabindex="0">
                        <div class="detail-icon" role="img" aria-label="Humidity">üíß</div>
                        <div class="detail-info">
                            <div class="detail-label">Humidity</div>
                            <div class="detail-value" id="humidity">{{ weather.humidity }}%</div>
                        </div>
                    </div>
                    <div class="detail-item" tabindex="0">
                        <div class="detail-icon" role="img" aria-label="Wind speed">üí®</div>
                        <div class="detail-info">
                            <div class="detail-label">Wind Speed</div>
                            <div class="detail-value" id="windSpeed">{{ weather.wind_speed }}km/h</div>
                        </div>
                    </div>
                </div>

                <div class="forecast-section">
                    <h3 class="forecast-title">3-Day Forecast</h3>
                    <div class="forecast-days" id="forecastDays">
                        {% for day in weather.forecast %}
                        <div class="day-card" tabindex="0" role="button" aria-label="Weather for {{ day.day }}: {{ day.desc }}, {{ day.temp }} degrees">
                            <div class="day-name">{{ day.day }}</div>
                            <div class="weather-icon" role="img" aria-label="{{ day.desc }}">{{ day.icon }}</div>
                            <div class="day-temp">{{ day.temp }}¬∞</div>
                            <div class="day-desc">{{ day.desc }}</div>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- Additional Weather Info -->
                <div class="additional-info">
                    <div class="weather-advice" id="weatherAdvice">
                        <h4>Weather Advice</h4>
                        <p id="adviceText">Perfect weather for outdoor activities! Don't forget your sunglasses.</p>
                    </div>
                </div>
            </aside>
        </main>

        <!-- Loading Overlay -->
        <div class="loading-overlay" id="loadingOverlay" style="display: none;" role="dialog" aria-label="Loading weather data">
            <div class="loading-spinner" aria-hidden="true"></div>
            <p>Getting weather data...</p>
        </div>

        <!-- Error Toast -->
        <div class="error-toast" id="errorToast" style="display: none;" role="alert" aria-live="polite">
            <span class="error-icon">‚ö†Ô∏è</span>
            <span class="error-message" id="errorMessage"></span>
            <button class="close-toast" onclick="hideErrorToast()" aria-label="Close error message">√ó</button>
        </div>

        <!-- Success Toast -->
        <div class="success-toast" id="successToast" style="display: none;" role="alert" aria-live="polite">
            <span class="success-icon">‚úÖ</span>
            <span class="success-message" id="successMessage"></span>
            <button class="close-success-toast" onclick="hideSuccessToast()" aria-label="Close success message">√ó</button>
        </div>

        <!-- Chat Widget -->
        <div class="chat-widget" onclick="openChat()" tabindex="0" role="button" aria-label="Open weather assistant chat" onkeypress="handleChatKeypress(event)">
            <div class="chat-icon" aria-hidden="true">üí¨</div>
            <span class="chat-text">Weather Assistant</span>
            <div class="chat-notification" id="chatNotification" style="display: none;">1</div>
        </div>

        <!-- Unit Toggle -->
        <div class="unit-toggle" id="unitToggle">
            <button class="unit-btn active" id="celsiusBtn" onclick="setTemperatureUnit('celsius')" aria-label="Switch to Celsius">¬∞C</button>
            <button class="unit-btn" id="fahrenheitBtn" onclick="setTemperatureUnit('fahrenheit')" aria-label="Switch to Fahrenheit">¬∞F</button>
        </div>

        <!-- Theme Toggle -->
        <div class="theme-toggle" onclick="toggleTheme()" tabindex="0" role="button" aria-label="Toggle dark/light theme" onkeypress="handleThemeKeypress(event)">
            <span class="theme-icon" id="themeIcon">üåô</span>
        </div>

        <!-- Location Services -->
        <div class="location-services">
            <button class="location-btn" onclick="getCurrentLocation()" aria-label="Use current location for weather">
                <span class="location-icon">üìç</span>
                <span class="location-text">Use My Location</span>
            </button>
        </div>
    </div>

    <!-- Scripts -->
    <script>
        // Pass weather data from Flask to JavaScript
        window.initialWeatherData = {
            location: "{{ weather.location }}",
            temperature: {{ weather.temperature }},
            feels_like: {{ weather.feels_like }},
            description: "{{ weather.description }}",
            humidity: {{ weather.humidity }},
            wind_speed: {{ weather.wind_speed }},
            sunrise: "{{ weather.sunrise }}",
            sunset: "{{ weather.sunset }}",
            forecast: {{ weather.forecast | tojson }}
        };
    </script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>

    <script>
        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, initializing weather app...');

            // Initialize core functionality
            if (typeof initializeApp === 'function') {
                initializeApp();
            }

            // Start animations
            if (typeof createRaindrops === 'function') {
                createRaindrops();
            }

            if (typeof startCloudAnimations === 'function') {
                startCloudAnimations();
            }

            // Set initial weather advice
            updateWeatherAdvice();

            // Initialize theme
            initializeTheme();

            // Add keyboard navigation
            addKeyboardNavigation();

            console.log('Weather app initialized successfully!');
        });

        // Additional helper functions for enhanced functionality
        function handleSignUp() {
            showSuccessToast('Sign up feature coming soon! Stay tuned for updates.');
        }

        function refreshWeather() {
            const currentLocation = document.getElementById('location').textContent;
            const cityName = currentLocation.split(',')[0];

            document.getElementById('cityInput').value = cityName;
            searchWeather();
        }

        function updateWeatherAdvice() {
            const temp = window.initialWeatherData?.temperature || 20;
            const description = window.initialWeatherData?.description?.toLowerCase() || '';
            const adviceElement = document.getElementById('adviceText');

            let advice = '';

            if (temp > 25) {
                advice = 'Hot weather ahead! Stay hydrated and wear light clothing.';
            } else if (temp < 5) {
                advice = 'Bundle up! It\'s quite cold outside. Don\'t forget your winter coat.';
            } else if (description.includes('rain')) {
                advice = 'Don\'t forget your umbrella! Rain is expected today.';
            } else if (description.includes('cloud')) {
                advice = 'Partly cloudy conditions. Perfect for a walk in the park!';
            } else {
                advice = 'Great weather for outdoor activities! Enjoy your day!';
            }

            if (adviceElement) {
                adviceElement.textContent = advice;
            }
        }

        function handleChatKeypress(event) {
            if (event.key === 'Enter' || event.key === ' ') {
                event.preventDefault();
                openChat();
            }
        }

        function handleThemeKeypress(event) {
            if (event.key === 'Enter' || event.key === ' ') {
                event.preventDefault();
                toggleTheme();
            }
        }

        function showSuccessToast(message) {
            const successToast = document.getElementById('successToast');
            const successMessage = document.getElementById('successMessage');

            if (successMessage && successToast) {
                successMessage.textContent = message;
                successToast.style.display = 'flex';

                setTimeout(() => {
                    hideSuccessToast();
                }, 5000);
            }
        }

        function hideSuccessToast() {
            const successToast = document.getElementById('successToast');
            if (successToast) {
                successToast.style.display = 'none';
            }
        }

        function setTemperatureUnit(unit) {
            // Toggle active states
            document.getElementById('celsiusBtn').classList.toggle('active', unit === 'celsius');
            document.getElementById('fahrenheitBtn').classList.toggle('active', unit === 'fahrenheit');

            // Convert temperature display
            const tempElement = document.getElementById('currentTemp');
            const feelsLikeElement = document.getElementById('feelsLike');

            // This would typically involve converting the actual temperature values
            // For now, just update the unit display
            const tempElements = document.querySelectorAll('.temp-unit');
            tempElements.forEach(el => {
                el.textContent = unit === 'celsius' ? 'C' : 'F';
            });

            showSuccessToast(`Temperature unit changed to ${unit === 'celsius' ? 'Celsius' : 'Fahrenheit'}`);
        }

        function toggleTheme() {
            document.body.classList.toggle('dark-theme');
            const themeIcon = document.getElementById('themeIcon');
            const isDark = document.body.classList.contains('dark-theme');

            if (themeIcon) {
                themeIcon.textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
            }

            // Save theme preference
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        }

        function initializeTheme() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-theme');
                const themeIcon = document.getElementById('themeIcon');
                if (themeIcon) {
                    themeIcon.textContent = '‚òÄÔ∏è';
                }
            }
        }

        function getCurrentLocation() {
            if (!navigator.geolocation) {
                showErrorToast('Geolocation is not supported by this browser.');
                return;
            }

            showLoading(true);

            navigator.geolocation.getCurrentPosition(
                async function(position) {
                    const lat = position.coords.latitude;
                    const lon = position.coords.longitude;

                    try {
                        // Use reverse geocoding to get city name, then search
                        const response = await fetch(`/api/weather/coordinates?lat=${lat}&lon=${lon}`);
                        const data = await response.json();

                        if (response.ok) {
                            updateWeatherDisplay(data);
                            showSuccessToast('Weather updated for your location!');
                        } else {
                            showErrorToast('Unable to get weather for your location.');
                        }
                    } catch (error) {
                        showErrorToast('Error getting weather for your location.');
                    } finally {
                        showLoading(false);
                    }
                },
                function(error) {
                    showLoading(false);
                    let message = 'Unable to get your location.';

                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            message = 'Location access denied. Please enable location services.';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            message = 'Location information is unavailable.';
                            break;
                        case error.TIMEOUT:
                            message = 'Location request timed out.';
                            break;
                    }

                    showErrorToast(message);
                }
            );
        }

        function addKeyboardNavigation() {
            // Add keyboard navigation for better accessibility
            const interactiveElements = document.querySelectorAll('.day-card, .detail-item');

            interactiveElements.forEach(element => {
                element.addEventListener('keypress', function(event) {
                    if (event.key === 'Enter' || event.key === ' ') {
                        event.preventDefault();
                        this.click();
                    }
                });
            });
        }

        // Service Worker registration for offline functionality (optional)
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                // Register service worker if available
                console.log('Service Worker support detected');
            });
        }

        // Error handling for missing functions
        function showLoading(show) {
            const loadingOverlay = document.getElementById('loadingOverlay');
            if (loadingOverlay) {
                loadingOverlay.style.display = show ? 'flex' : 'none';
            }
        }

        function showErrorToast(message) {
            const errorToast = document.getElementById('errorToast');
            const errorMessage = document.getElementById('errorMessage');

            if (errorMessage && errorToast) {
                errorMessage.textContent = message;
                errorToast.style.display = 'flex';

                setTimeout(() => {
                    hideErrorToast();
                }, 5000);
            }
        }

        function hideErrorToast() {
            const errorToast = document.getElementById('errorToast');
            if (errorToast) {
                errorToast.style.display = 'none';
            }
        }
    </script>
</body>
</html>